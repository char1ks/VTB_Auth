<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–†–∏—Å–æ–≤–∞–Ω–∏–µ –∏ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #000; /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
            color: #fff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
            margin: 0;
            overflow: hidden; /* –°–∫—Ä—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã, –≤—ã—Ö–æ–¥—è—â–∏–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–º–∞–π–ª–æ–≤ */
        }
        h1 {
            margin-bottom: 20px;
            color: #fff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        }
        #drawingCanvas {
            border: 1px solid #fff; /* –ë–µ–ª–∞—è —Ä–∞–º–∫–∞ –¥–ª—è —Ö–æ–ª—Å—Ç–∞ */
            margin-bottom: 20px;
            background-color: #fff; /* –ë–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è —Ö–æ–ª—Å—Ç–∞ */
            box-shadow: 0 0px 20px rgba(255, 255, 255, 20); /* –¢–µ–Ω—å –¥–ª—è –∫–∞–Ω–≤–∞—Å–∞ */
            position: relative; /* –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è z-index */
            z-index: 10; /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ–∫–∏–π z-index –¥–ª—è –∫–∞–Ω–≤–∞—Å–∞ */
        }
        #drawingForm {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10; /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ–∫–∏–π z-index –¥–ª—è —Ñ–æ—Ä–º—ã —Ä–∏—Å–æ–≤–∞–Ω–∏—è */
        }
        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            margin: 5px;
            transition: color 0.3s;
            color: #fff; /* –ë–µ–ª—ã–π —Ü–≤–µ—Ç –∏–∫–æ–Ω–æ–∫ */
        }
        .icon-button:hover {
            color: #ccc; /* –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–º–∞–π–ª–æ–≤ */
        .emoji {
            position: absolute;
            opacity: 0.8;
            pointer-events: none; /* –ß—Ç–æ–±—ã —Å–º–∞–π–ª—ã –Ω–µ –º–µ—à–∞–ª–∏ –∫–ª–∏–∫–∞–º –ø–æ –¥—Ä—É–≥–∏–º —ç–ª–µ–º–µ–Ω—Ç–∞–º */
            z-index: 5; /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º z-index –¥–ª—è —Å–º–∞–π–ª–æ–≤ –Ω–∏–∂–µ –∫–∞–Ω–≤–∞—Å–∞ */
        }
    </style>
    <script>
        let canvas, ctx;
        let drawing = false;
        let eraserMode = false; // –†–µ–∂–∏–º –ª–∞—Å—Ç–∏–∫–∞
        function initCanvas() {
            canvas = document.getElementById("drawingCanvas");
            ctx = canvas.getContext("2d");
            canvas.width = 800;
            canvas.height = 600;
            canvas.addEventListener("mousedown", startDrawing);
            canvas.addEventListener("mouseup", stopDrawing);
            canvas.addEventListener("mousemove", draw);
        }
        function startDrawing(event) {
            drawing = true;
            draw(event);
        }
        function stopDrawing() {
            drawing = false;
            ctx.beginPath();
        }
        function draw(event) {
            if (!drawing) return;
            ctx.lineWidth = 5;
            ctx.lineCap = "round";
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–∏—Å–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ª–∞—Å—Ç–∏–∫–∞
            if (eraserMode) {
                ctx.globalCompositeOperation = "destination-out"; // –†–µ–∂–∏–º –ª–∞—Å—Ç–∏–∫–∞
                ctx.strokeStyle = "white"; // –¶–≤–µ—Ç –ª–∞—Å—Ç–∏–∫–∞
            } else {
                ctx.globalCompositeOperation = "source-over"; // –†–µ–∂–∏–º —Ä–∏—Å–æ–≤–∞–Ω–∏—è
                ctx.strokeStyle = "black"; // –¶–≤–µ—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è
            }
            ctx.lineTo(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop);
        }
        async function saveDrawing() {
            const imageData = canvas.toDataURL("image/png");
            const byteString = atob(imageData.split(',')[1]);
            const mimeString = imageData.split(',')[0].split(':')[1].split(';')[0];
            const arrayBuffer = new Uint8Array(byteString.length);
            for (let i = 0; i < byteString.length; i++) {
                arrayBuffer[i] = byteString.charCodeAt(i);
            }
            try {
                const response = await fetch('http://localhost:80/FA/visual_pattern_check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ picture: arrayBuffer })
                });
                if (response.ok) {
                    // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π
                    window.location.href = '/page/mainPage'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π URL
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:', response.statusText);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }
        function toggleEraser() {
            eraserMode = !eraserMode; // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –ª–∞—Å—Ç–∏–∫–∞
            const eraserIcon = document.getElementById("eraserIcon");
            const pencilIcon = document.getElementById("pencilIcon");
            if (eraserMode) {
                eraserIcon.style.display = "none"; // –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∫–∞—Ä–∞–Ω–¥–∞—à–∞
                pencilIcon.style.display = "inline"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –ª–∞—Å—Ç–∏–∫–∞
            } else {
                eraserIcon.style.display = "inline"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∫–∞—Ä–∞–Ω–¥–∞—à–∞
                pencilIcon.style.display = "none"; // –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –ª–∞—Å—Ç–∏–∫–∞
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–∞–π–ª–æ–≤
        const emojis = ['üåõ','‚òÄÔ∏è','‚≠êÔ∏è','üåï','‚ö°Ô∏è'];
        const numEmojis = 20; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–∞–π–ª–æ–≤
        function createEmoji() {
            const emoji = document.createElement('div');
            emoji.className = 'emoji';
            emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
            emoji.style.left = Math.random() * 100 + 'vw';
            emoji.style.top = Math.random() * 100 + 'vh';
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä
            const randomSize = Math.random() * 40 + 10; // –†–∞–∑–º–µ—Ä –æ—Ç 10 –¥–æ 50 –ø–∏–∫—Å–µ–ª–µ–π
            emoji.style.fontSize = randomSize + 'px';
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–º–∞–π–ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.body.appendChild(emoji);
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
            const animationDuration = Math.random() * 5 + 5; // –°–ª—É—á–∞–π–Ω–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
            emoji.animate([
                { transform: `translateY(0)` },
                { transform: `translateY(-100vh)` }
            ], {
                duration: animationDuration * 1000,
                easing: 'linear',
                iterations: 1,
                fill: 'forwards'
            });
            // –£–¥–∞–ª—è–µ–º —Å–º–∞–π–ª –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                emoji.remove();
            }, animationDuration * 1000);
        }
        // –°–æ–∑–¥–∞–µ–º —Å–º–∞–π–ª—ã —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
        setInterval(createEmoji, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    </script>
</head>
<body onload="initCanvas()">
<h1>–†–∏—Å–æ–≤–∞–Ω–∏–µ –∏ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</h1>
<canvas id="drawingCanvas"></canvas>
<div id="drawingForm" style="display: flex; flex-direction: column; align-items: center;">
    <input type="hidden" id="imageData" name="imageData" />
    <button type="button" class="icon-button" onclick="saveDrawing()">
        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
    </button>
    <button type="button" class="icon-button" id="eraserIcon" onclick="toggleEraser()">
        <i class="fas fa-pencil-alt"></i> <!-- –ò–∫–æ–Ω–∫–∞ –∫–∞—Ä–∞–Ω–¥–∞—à–∞ -->
    </button>
    <button type="button" class="icon-button" id="pencilIcon" style="display: none;" onclick="toggleEraser()">
        <i class="fas fa-smile"></i> <!-- –ò–∫–æ–Ω–∫–∞ —Å–º–∞–π–ª–∏–∫–∞ -->
    </button>
</div>
</body>
</html>